{% extends 'base.html.twig' %}

{% block title %}Paiement de la réservation{% endblock %}

{% block body %}
<div class="container mt-5">
    <h1>Paiement de votre réservation</h1>
    <p>Votre réservation a été enregistrée. Cliquez sur le bouton ci-dessous pour payer avec Stripe.</p>
    
    <button id="stripePayBtn" class="btn btn-primary">Payer avec Stripe</button>
    <a href="{{ path('homepage') }}" class="btn btn-secondary">Retour à l'accueil</a>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe("{{ stripe_public_key }}");

    document.getElementById("stripePayBtn").addEventListener("click", function() {
        // Call the checkout endpoint with the booking id
        fetch("/checkout/{{ booking.id }}")
            .then(response => response.json())
            .then(session => {
                stripe.redirectToCheckout({ sessionId: session.id });
            })
            .catch(error => console.error("Erreur :", error));
    });
</script>
{% endblock %}
